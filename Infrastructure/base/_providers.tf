terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 4.0"
    }
  }
}

provider "aws" {
  region = "us-east-1"
  # profile = "default" si no esta explicito agarra el default
  # assume_role {
  #   role_arn = "arn:aws:iam::353129431097:role/LabRole"
  # }
}

data "aws_eks_cluster_auth" "cluster_taller_devops" {
  name = module.eks_taller_devops.cluster_name
}

provider "kubernetes" {
  host                   = "https://F1F6A4F7740A66705018132D1C13FFB2.gr7.us-east-1.eks.amazonaws.com" #data.aws_eks_cluster.eks.endpoint
  cluster_ca_certificate = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EWXlNVEl6TURBeU5sb1hEVE16TURZeE9ESXpNREF5Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSnJKCm96UVczaURkbld3cjFPQlNieXRJUk1WNFRaSGZ4RHRMR3EwY1dReHNBcWtGdUcvdE53OGZVNWoxci9KSnNsNmwKVVpsb2c0MzhKdklodkFHTWpCOVNKdlJ1SmRQZThPbmpDTytSLzZWSEl1V0RsakJSbDZFUHhCWU5CODAxNXl3WApJMmlMZVVQNGJDM3NwbGZpWjJsc0xkU090MCtsOHQxazNiblNNWWhkMGNvN3hORmNQMDA1TFZab0tiNm5wVDRaCnpaekIzSFEwY2VIaVlHbmhGak1mWGVaSVFUMmxFNjVpOUROTVJIcFhPMllybG9UZ3NaUk8xd3htNVNaSlgwZGgKR25GVlhrRzJhVlhrV0EvNE03TDBjL004ZXBKYTBEc1NtTFUwZml3SXBHRGdsUzFvWWRjNVdVTWxtcjhvM205aAo0cTV2cDhvTTV3UXhhMFhxWWFzQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZGaUFtSHZlYmZLd1NISHV0Q1lOZXZLa2ZxMWVNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRDBOV0huM0hrYUlkOTNTSWxRbgpuMkZlcTJPWDRIczlkQnNhNStkRk0rb3JyRzJvcyt4dEFpRmNRV2hMUTNZRWdVdytaNi9wZzd4ZDJTdFRvSlpmCjVEWVJPQzZhRzNxL0tsTWZhSTFsMUM5WXZIaUFuNE8zL0x6OUpHT3dFaGRsRTFhbnEweWxyNHRDSTFoQVc4SSsKM0tSd05ZRkFQOWJWcVdPRm1xcENkYXBwMFNBWGRFa2hnSFl5OFp2Q2R0eHZrS0VIb2plZFNtZUpDOXFnL2lYMwpOeElxSWczQnRIQUdwU1VYcTR6WDBKVnNhcktBYTdZMTlIR0R2SE1LR2g1RnpSUUdLMEVVd3Y5U0FhZ3QrOE54Ci80S0ZMWndoYzAwcG91cklYelBESmZ5dTdGN1ZIaGtUNldRZ2ViS3ZwcHZrcytDM3R0WlZyUSswbGtMcVNKRXcKOGtnPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==") # base64decode(data.aws_eks_cluster.eks.certificate_authority[0].data)
  token                  =  data.aws_eks_cluster_auth.cluster_taller_devops.token
}

provider "helm" {
  kubernetes {
    host                   = "https://F1F6A4F7740A66705018132D1C13FFB2.gr7.us-east-1.eks.amazonaws.com"
    cluster_ca_certificate = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EWXlNVEl6TURBeU5sb1hEVE16TURZeE9ESXpNREF5Tmxvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSnJKCm96UVczaURkbld3cjFPQlNieXRJUk1WNFRaSGZ4RHRMR3EwY1dReHNBcWtGdUcvdE53OGZVNWoxci9KSnNsNmwKVVpsb2c0MzhKdklodkFHTWpCOVNKdlJ1SmRQZThPbmpDTytSLzZWSEl1V0RsakJSbDZFUHhCWU5CODAxNXl3WApJMmlMZVVQNGJDM3NwbGZpWjJsc0xkU090MCtsOHQxazNiblNNWWhkMGNvN3hORmNQMDA1TFZab0tiNm5wVDRaCnpaekIzSFEwY2VIaVlHbmhGak1mWGVaSVFUMmxFNjVpOUROTVJIcFhPMllybG9UZ3NaUk8xd3htNVNaSlgwZGgKR25GVlhrRzJhVlhrV0EvNE03TDBjL004ZXBKYTBEc1NtTFUwZml3SXBHRGdsUzFvWWRjNVdVTWxtcjhvM205aAo0cTV2cDhvTTV3UXhhMFhxWWFzQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZGaUFtSHZlYmZLd1NISHV0Q1lOZXZLa2ZxMWVNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRDBOV0huM0hrYUlkOTNTSWxRbgpuMkZlcTJPWDRIczlkQnNhNStkRk0rb3JyRzJvcyt4dEFpRmNRV2hMUTNZRWdVdytaNi9wZzd4ZDJTdFRvSlpmCjVEWVJPQzZhRzNxL0tsTWZhSTFsMUM5WXZIaUFuNE8zL0x6OUpHT3dFaGRsRTFhbnEweWxyNHRDSTFoQVc4SSsKM0tSd05ZRkFQOWJWcVdPRm1xcENkYXBwMFNBWGRFa2hnSFl5OFp2Q2R0eHZrS0VIb2plZFNtZUpDOXFnL2lYMwpOeElxSWczQnRIQUdwU1VYcTR6WDBKVnNhcktBYTdZMTlIR0R2SE1LR2g1RnpSUUdLMEVVd3Y5U0FhZ3QrOE54Ci80S0ZMWndoYzAwcG91cklYelBESmZ5dTdGN1ZIaGtUNldRZ2ViS3ZwcHZrcytDM3R0WlZyUSswbGtMcVNKRXcKOGtnPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==") # base64decode(data.aws_eks_cluster.eks.certificate_authority[0].data)
    token                  = data.aws_eks_cluster_auth.cluster_taller_devops.token
  }
}